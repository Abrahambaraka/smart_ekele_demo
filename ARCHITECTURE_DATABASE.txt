================================================================================
ARCHITECTURE - INTERACTION PAGES â†” BASE DE DONNÃ‰ES
================================================================================

ğŸ“‹ VUE D'ENSEMBLE
--------------------------------------------------------------------------------
Smart Ekele est une application MULTI-UTILISATEURS de gestion scolaire.

PRINCIPE MULTI-Ã‰COLES:
  - Chaque Ã©cole possÃ¨de son propre compte avec un identifiant unique (school_id)
  - Chaque Ã©cole a ses propres donnÃ©es (Ã©tudiants, classes, paiements, etc.)
  - Les donnÃ©es d'une Ã©cole sont ISOLÃ‰ES des autres Ã©coles
  - Les utilisateurs ne voient QUE les donnÃ©es de leur Ã©cole

HIÃ‰RARCHIE DES RÃ”LES:
  1. Director      â†’ GÃ¨re l'Ã©cole (Ã©tudiants, professeurs, classes, paiements)
  2. Teacher       â†’ GÃ¨re ses classes (notes, prÃ©sence)

ARCHITECTURE TECHNIQUE:
  Pages (React) â†’ API Service (Axios) â†’ Backend (Express) â†’ Base de donnÃ©es (MySQL)


ğŸ”„ FLUX DE DONNÃ‰ES
--------------------------------------------------------------------------------

1. FRONTEND â†’ BACKEND
   - L'utilisateur interagit avec une page React
   - La page appelle une fonction du service API (services/api.ts)
   - Axios envoie une requÃªte HTTP au backend (port 3000)
   
2. BACKEND â†’ BASE DE DONNÃ‰ES
   - Le serveur Express reÃ§oit la requÃªte
   - Le routeur appropriÃ© traite la requÃªte
   - Le repository exÃ©cute la requÃªte SQL sur MySQL
   
3. BACKEND â†’ FRONTEND
   - Le serveur renvoie les donnÃ©es en JSON
   - Axios reÃ§oit la rÃ©ponse
   - La page React met Ã  jour l'Ã©tat avec useState/useEffect


ğŸ“ STRUCTURE DES FICHIERS
--------------------------------------------------------------------------------

services/api.ts
  â”œâ”€ authAPI        â†’ Authentification (login, getProfile)
  â”œâ”€ studentsAPI    â†’ Gestion des Ã©tudiants (CRUD)
  â”œâ”€ teachersAPI    â†’ Gestion des enseignants
  â”œâ”€ classesAPI     â†’ Gestion des classes
  â”œâ”€ paymentsAPI    â†’ Gestion des paiements
  â”œâ”€ reportsAPI     â†’ Statistiques et rapports
  â””â”€ ... (13 modules au total)

server/routes/
  â”œâ”€ auth.routes.ts      â†’ Endpoints /api/auth/*
  â”œâ”€ student.routes.ts   â†’ Endpoints /api/students/*
  â”œâ”€ payment.routes.ts   â†’ Endpoints /api/payments/*
  â””â”€ ... (13 fichiers de routes)

database/
  â”œâ”€ db.ts          â†’ Connexion MySQL + Repositories
  â”œâ”€ schema.sql     â†’ Structure des tables
  â””â”€ seed_data.sql  â†’ DonnÃ©es de dÃ©monstration


ğŸ” AUTHENTIFICATION & ISOLATION DES DONNÃ‰ES
--------------------------------------------------------------------------------

1. Login (pages/Login.tsx)
   - Appelle authAPI.login(email, password)
   - Backend vÃ©rifie le mot de passe avec bcrypt
   - GÃ©nÃ¨re un token JWT si succÃ¨s
   - Frontend stocke le token dans localStorage
   - Le token contient: id, email, role, schoolId

2. RequÃªtes authentifiÃ©es
   - Axios ajoute automatiquement le token dans les headers
   - Backend vÃ©rifie le token avec middleware auth
   - Rejette si token invalide ou expirÃ©

3. ISOLATION DES DONNÃ‰ES PAR Ã‰COLE
   - Chaque requÃªte filtre par school_id de l'utilisateur connectÃ©
   - Exemple: studentsAPI.getAll({ school_id: user.schoolId })
   - SQL: SELECT * FROM students WHERE school_id = 1
   - Un directeur de l'Ã©cole A ne peut PAS voir les donnÃ©es de l'Ã©cole B
   
4. HIÃ‰RARCHIE D'ACCÃˆS
   Director (Directeur d'Ã©cole):
     - Voit UNIQUEMENT son Ã©cole (school_id = user.schoolId)
     - GÃ¨re: Ã©tudiants, professeurs, classes, paiements, notes
     - Peut crÃ©er des utilisateurs pour son Ã©cole
   
   Teacher (Professeur):
     - Voit UNIQUEMENT ses classes et ses Ã©tudiants
     - Peut saisir notes et prÃ©sences
     - AccÃ¨s limitÃ© aux donnÃ©es de son Ã©cole


ğŸ“Š EXEMPLE CONCRET : GESTION DES Ã‰TUDIANTS (MULTI-Ã‰COLES)
--------------------------------------------------------------------------------

SCÃ‰NARIO: Directeur de l'Ã©cole "Complexe Scolaire Ekele" (school_id = 1)

pages/StudentManagement.tsx
  â†“
  const { user } = useAuth()  // user.schoolId = 1, user.role = "Director"
  â†“
  useEffect(() => fetchData())
  â†“
  studentsAPI.getAll({ school_id: user.schoolId })  // Filtre par Ã©cole
  â†“
  axios.get('/api/students', { params: { school_id: 1 } })
  â†“
  server/routes/student.routes.ts â†’ GET /api/students?school_id=1
  â†“
  database/db.ts â†’ StudentRepository.findAll(school_id)
  â†“
  MySQL: SELECT * FROM students WHERE school_id = 1
       â†’ Retourne UNIQUEMENT les Ã©tudiants de l'Ã©cole 1
       â†’ Les Ã©tudiants des Ã©coles 2, 3, 4... sont EXCLUS
  â†“
  Retourne JSON: { success: true, data: [Ã©tudiants de l'Ã©cole 1] }
  â†“
  setStudents(response.data)
  â†“
  Affichage dans le tableau React (UNIQUEMENT Ã©cole 1)

EXEMPLE MULTI-Ã‰COLES:
  Ã‰cole 1: "Complexe Scolaire Ekele"     â†’ 150 Ã©tudiants
  Ã‰cole 2: "LycÃ©e Moderne de Kinshasa"   â†’ 5 Ã©tudiants
  
  â†’ Le directeur de l'Ã©cole 1 voit UNIQUEMENT ses 150 Ã©tudiants
  â†’ Le directeur de l'Ã©cole 2 voit UNIQUEMENT ses 5 Ã©tudiants
  â†’ Chaque professeur voit UNIQUEMENT les Ã©tudiants de son Ã©cole


ğŸ’¾ OPÃ‰RATIONS CRUD
--------------------------------------------------------------------------------

CREATE (Ajouter)
  Page: handleSubmit() â†’ API: .create(data)
  Backend: INSERT INTO table VALUES (...)
  
READ (Lire)
  Page: useEffect() â†’ API: .getAll() ou .getById(id)
  Backend: SELECT * FROM table WHERE ...
  
UPDATE (Modifier)
  Page: handleEdit() â†’ API: .update(id, data)
  Backend: UPDATE table SET ... WHERE id = ?
  
DELETE (Supprimer)
  Page: handleDelete() â†’ API: .delete(id)
  Backend: DELETE FROM table WHERE id = ?


ğŸ” FILTRAGE ET RECHERCHE
--------------------------------------------------------------------------------

Exemple: PaymentManagement
  - Frontend: filter par status, search par nom Ã©tudiant
  - Filtrage cÃ´tÃ© client aprÃ¨s rÃ©cupÃ©ration des donnÃ©es
  - Optimisation possible: filtrage cÃ´tÃ© serveur avec query params


ğŸ“ˆ RAPPORTS ET STATISTIQUES
--------------------------------------------------------------------------------

pages/SchoolDirectorDashboard.tsx
  â†“
  reportsAPI.getComprehensive(school_id)
  â†“
  Backend exÃ©cute plusieurs requÃªtes SQL avec JOIN et COUNT
  â†“
  Retourne statistiques agrÃ©gÃ©es (total Ã©tudiants, paiements, etc.)


âš™ï¸ CONFIGURATION
--------------------------------------------------------------------------------

.env (Backend)
  DB_HOST=localhost
  DB_USER=root
  DB_PASSWORD=root
  DB_NAME=smart_ekele_db

.env.local (Frontend)
  VITE_API_URL=http://localhost:3000/api

Ports:
  - Backend: http://localhost:3000
  - Frontend: http://localhost:5173


ğŸ›¡ï¸ SÃ‰CURITÃ‰
--------------------------------------------------------------------------------

1. Mots de passe hashÃ©s avec bcrypt (10 rounds)
2. Tokens JWT avec expiration
3. Middleware d'authentification sur routes protÃ©gÃ©es
4. CORS configurÃ© pour accepter localhost:5173
5. Validation des donnÃ©es cÃ´tÃ© serveur


ğŸ“¦ DÃ‰PENDANCES CLÃ‰S
--------------------------------------------------------------------------------

Frontend:
  - axios: Client HTTP pour appeler l'API
  - react: Interface utilisateur
  
Backend:
  - express: Serveur web
  - mysql2: Connexion Ã  MySQL
  - jsonwebtoken: Authentification JWT
  - bcrypt: Hashage des mots de passe
  - dotenv: Variables d'environnement


ğŸš€ DÃ‰MARRAGE
--------------------------------------------------------------------------------

1. Base de donnÃ©es:
   mysql -u root -p
   CREATE DATABASE smart_ekele_db;
   SOURCE database/schema.sql;

2. Backend:
   npm run server:dev
   â†’ Serveur dÃ©marre sur port 3000

3. Frontend:
   npm run dev
   â†’ Application dÃ©marre sur port 5173

4. Test:
   Login: directeur@demo.com / password123


ğŸ“ NOTES IMPORTANTES
--------------------------------------------------------------------------------

- Toutes les pages utilisent le mÃªme pattern: useState + useEffect + API calls
- Les donnÃ©es sont chargÃ©es au montage du composant
- Le loading state affiche un spinner pendant les requÃªtes
- Les erreurs sont gÃ©rÃ©es avec try/catch et alert()
- schoolId vient de l'utilisateur connectÃ© (user.schoolId)
- Le token JWT est automatiquement ajoutÃ© par axios interceptor

ğŸ« GESTION MULTI-Ã‰COLES
--------------------------------------------------------------------------------

TABLES PRINCIPALES:
  schools         â†’ Liste de toutes les Ã©coles
  users           â†’ Utilisateurs (avec school_id)
  students        â†’ Ã‰tudiants (avec school_id)
  teachers        â†’ Professeurs (avec school_id)
  classes         â†’ Classes (avec school_id)
  payments        â†’ Paiements (avec school_id via students)
  grades          â†’ Notes (avec school_id via classes)
  attendance      â†’ PrÃ©sences (avec school_id via classes)
  
RELATIONS:
  1 Ã‰cole â†’ N Utilisateurs (directeurs, professeurs)
  1 Ã‰cole â†’ N Ã‰tudiants
  1 Ã‰cole â†’ N Professeurs
  1 Ã‰cole â†’ N Classes
  1 Directeur â†’ GÃ¨re 1 Ã‰cole
  1 Professeur â†’ Enseigne dans 1 Ã‰cole, a N Classes

EXEMPLES DE DONNÃ‰ES:
  
  Ã‰cole 1: Complexe Scolaire Ekele (school_id = sch-001)
    - Directeur: directeur@demo.com (password: password123)
    - Professeurs: professeur@demo.com (password: password123)
    - Ã‰tudiants: 150 Ã©lÃ¨ves
    - Classes: CP1, CP2, CE1, CE2, CM1, CM2
  
  Ã‰cole 2: LycÃ©e Moderne de Kinshasa (school_id = sch-002)
    - Directeur: directeur.lycee@smartekele.com (password: admin123)
    - Professeur: prof.lycee@smartekele.com (password: admin123)
    - Ã‰tudiants: 5 Ã©lÃ¨ves
    - Classes: 6Ã¨me A, 5Ã¨me B, Terminale Scientifique

FLUX TYPIQUE D'UN DIRECTEUR:
  1. Login avec directeur@demo.com
  2. AuthContext rÃ©cupÃ¨re user.schoolId = 1
  3. Toutes les requÃªtes incluent school_id = 1
  4. Voit UNIQUEMENT les donnÃ©es de son Ã©cole
  5. Peut gÃ©rer: Ã©tudiants, professeurs, classes, paiements
  6. Ne peut PAS voir les donnÃ©es d'autres Ã©coles

FLUX TYPIQUE D'UN PROFESSEUR:
  1. Login avec professeur@demo.com
  2. AuthContext rÃ©cupÃ¨re user.schoolId = 1
  3. TeacherDashboard trouve le professeur via email
  4. Charge les classes assignÃ©es au professeur
  5. Peut saisir notes et prÃ©sences UNIQUEMENT pour ses classes
  6. Voit UNIQUEMENT les Ã©tudiants de ses classes

SÃ‰CURITÃ‰ MULTI-Ã‰COLES:
  âœ“ Filtrage automatique par school_id dans toutes les requÃªtes
  âœ“ Validation cÃ´tÃ© serveur du school_id de l'utilisateur
  âœ“ ImpossibilitÃ© d'accÃ©der aux donnÃ©es d'une autre Ã©cole
  âœ“ Token JWT contient le school_id pour vÃ©rification
  âœ“ Middleware auth vÃ©rifie les permissions par rÃ´le

================================================================================
